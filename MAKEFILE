# Compiler and Flags
CC = gcc
CFLAGS = -Wall -Wextra -pedantic -std=c99
LDFLAGS = -lssl -lcrypto -lcurl
INCLUDES = -Iinclude

# Targets
TARGETS = pmll arc_agi_benchmark pmll_np_solver sat_test api_llama api

# Default target: Build all
.PHONY: all clean debug help
all: $(TARGETS)

# SAT Test target
sat_test: SAT_Compare.o Pmll_NP_Solver.o MiniSAT.o generate_3sat_instance.o SAT_Solver.o
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $@ $^

# API Llama target
api_llama: API_Llama.o
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $@ $^

# API target
api: API.o
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $@ $^

# Compile Rules
%.o: %.c
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

# Existing Targets
pmll: unified_voice.o pml_logic_loop.o memory_silo.o io_socket.o persistence.o cross_talk.o main.o
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $@ $^

pmll_np_solver: pmll_np_solver.o
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $@ $^

arc_agi_benchmark: arc_agi_benchmark.o
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $@ $^

# Run Commands
run: pmll
	@echo "Running pmll..."
	./pmll

run_arc_agi_benchmark: arc_agi_benchmark
	@echo "Running arc_agi_benchmark..."
	./arc_agi_benchmark

run_pmll_np_solver: pmll_np_solver
	@echo "Running pmll_np_solver..."
	./pmll_np_solver

run_sat_test: sat_test
	@echo "Running sat_test..."
	./sat_test

run_api_llama: api_llama
	@echo "Running api_llama..."
	./api_llama

run_api: api
	@echo "Running api..."
	./api

# Clean Target
clean:
	@echo "Cleaning up..."
	-rm -f *.o $(TARGETS)

# Debug Build
debug: CFLAGS += -g -O0
debug: $(TARGETS)

# Help Target
help:
	@echo "Makefile commands:"
	@echo "  all                  Build all targets."
	@echo "  clean                Remove all build artifacts."
	@echo "  debug                Build all targets with debug flags."
	@echo "  run                  Run the pmll executable."
	@echo "  run_arc_agi_benchmark Run the arc_agi_benchmark executable."
	@echo "  run_pmll_np_solver   Run the Pmll NP Solver."
	@echo "  run_sat_test         Run the SAT test."
	@echo "  run_api_llama        Run the API Llama."
	@echo "  run_api              Run the API."
